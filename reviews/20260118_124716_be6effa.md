# Code Review for Commit be6effa

**Date:** 2026-01-18 12:47:16
**Commit Message:** fix(reconciler): enable hooks through SmithersRoot.render()

- Add async render() method that waits for reconciler commit callback
- Update hook tests to use render() instead of mount() for simpler testing
- Fix JSX type declarations to augment React module instead of global
- Add integration tests proving useState, useContext, useMemo, useRef work
- Extend CSSProperties for OpenTUI terminal style props (fg, bg, etc.)

The jsx-runtime already delegates to React. This commit adds the test
infrastructure to verify hooks work correctly through the reconciler.

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>

---

### Summary

The commit has good intentions, aiming to enable React hooks and improve JSX typing for OpenTUI components. The move to augment the `react` module for JSX intrinsics and `CSSProperties` is a significant improvement over global declarations.

However, the changes introduce a critical bug by removing existing component type definitions and create redundant, inconsistent style types that will be difficult to maintain.

### Issues Found

1.  **Critical Bug: Missing Intrinsic Element Definitions**
    - **File:** `src/tui/opentui.d.ts`
    - **Lines:** ~48-73
    - **Description:** The previous type declarations included definitions for `<text>` and `<input>` components. The new changes have removed them entirely from the `JSX.IntrinsicElements` interface, which will cause TypeScript errors and break any part of the application using these components.

2.  **Redundant and Inconsistent Style Property Declarations**
    - **File:** `src/tui/opentui.d.ts`
    - **Lines:** ~17-47
    - **Description:** Terminal-specific style properties (like `fg`, `bg`, `bold`) are defined in two separate places:
        1.  Inside the augmentation of `React.CSSProperties`.
        2.  Again inside the `OpenTUIStyle` interface.

    This duplication is unnecessary because `OpenTUIStyle` extends `CSSProperties` and would inherit the properties automatically. This has already led to inconsistencies: `underline` is defined in `OpenTUIStyle` but is missing from the `CSSProperties` augmentation. This makes the types harder to maintain.

3.  **Reduced Type Safety on Components**
    - **File:** `src/tui/opentui.d.ts`
    - **Lines:** 54, 62
    - **Description:** The `box` and `scrollbox` element definitions now include `[key: string]: unknown`. This allows any prop to be passed to these components, defeating the purpose of TypeScript's static type checking for props.

### Suggested Improvements

1.  **Restore Missing Elements:** Reinstate the type definitions for `text` and `input` within the `JSX.IntrinsicElements` augmentation to prevent breaking existing code.

2.  **Consolidate Style Definitions:** Remove the redundant property declarations from the `OpenTUIStyle` interface. It should simply extend the augmented `CSSProperties`:
    ```typescript
    // 1. Augment CSSProperties with ALL terminal-specific styles
    declare module 'react' {
      interface CSSProperties {
        fg?: string;
        bg?: string;
        bold?: boolean;
        dim?: boolean;
        italic?: boolean;
        underline?: boolean; // Ensure all properties are here
        inverse?: boolean;
        hidden?: boolean;
        strikethrough?: boolean;
        border?: 'single' | 'double' | 'round' | 'bold' | 'singleDouble' | 'doubleSingle' | 'classic' | 'none';
        borderColor?: string;
        focusedBackgroundColor?: string;
        [key: string]: unknown; // Keep if truly needed, but preferably remove
      }
    }

    // 2. Simplify OpenTUIStyle to just extend it
    export interface OpenTUIStyle extends CSSProperties {}

    // 3. Or, even better, remove OpenTUIStyle and use CSSProperties directly
    // in the intrinsic element definitions.
    // e.g. style?: React.CSSProperties
    ```

3.  **Improve Prop Typing:** If possible, remove `[key: string]: unknown` from the component definitions and explicitly list the props they accept to improve type safety. If it's there to match the underlying library's API, consider adding a comment to explain why.
