# Review: 9fa1591

**Commit:** 9fa1591534606bd796ce0060e41bb19b70fc1eaa
**Message:** feat: implement Worktree component for parallel agent isolation
**Date:** 2026-01-06 23:44:41 UTC

## Feedback

- Command injection risk: `executeWorktreeNode` builds shell strings with unquoted `branch` (and `baseBranch`) and passes through `execSync`; a branch like `foo"; rm -rf /; "` will execute. Use `spawn/execFile` with args or validate/escape branch names. (`src/core/execute.ts`)
- Worktree failure doesn’t block child execution: `executeWorktreeNode` catches errors, sets `_execution.status='error'`, but `executePlan` keeps running Claude nodes; `getWorktreePath` returns null so agents run in the main repo instead of failing fast. Consider throwing on failure or marking children as blocked. (`src/core/execute.ts`)
- Reusing existing worktree ignores branch mismatch: if `path` exists and is a worktree, it’s reused without verifying `branch`/`baseBranch` intent. This can silently execute in the wrong branch. Add a HEAD/branch check and error if it doesn’t match. (`src/core/execute.ts`)
- Mock cleanup behavior contradicts tests/docs: `cleanupWorktreeNode` calls `onCleanup` even in `mockMode`, while tests expect it not to fire. Either adjust behavior or fix tests. (`src/core/execute.ts`, `evals/worktree.test.tsx`)
