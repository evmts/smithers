# Code Review for Commit 2e99c27

**Date:** 2026-01-18 14:33:01
**Commit Message:** fix(parser): add REPLACE INTO support to extractWriteTables

Standalone REPLACE INTO statements were not recognized, causing missed
invalidations. The existing insertRegex only handled INSERT OR REPLACE.

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>

---

### Summary
The change correctly adds support for standalone `REPLACE INTO` statements to the `extractWriteTables` function, which was a missing case. The implementation is correct and consistent with the existing style of the file.

### Suggestion for Improvement
For improved conciseness and to group related logic, consider merging the new regex with the existing `insertRegex`. Since `REPLACE INTO` is an alias for `INSERT OR REPLACE INTO`, their parsing logic can be unified.

You could replace the two separate blocks for `INSERT` and `REPLACE` with a single one:

```typescript
// In src/reactive-sqlite/parser.ts

// Replace:
  // INSERT INTO table_name or INSERT OR REPLACE INTO table_name
  const insertRegex = /\binsert\s+(?:or\s+\w+\s+)?into\s+([a-z_][a-z0-9_]*)/gi
  while ((match = insertRegex.exec(normalized)) !== null) {
    tables.add(match[1]!)
  }

  // REPLACE INTO table_name (standalone, not INSERT OR REPLACE which is handled by insertRegex)
  const replaceRegex = /\breplace\s+into\s+([a-z_][a-z0-9_]*)/gi
  while ((match = replaceRegex.exec(normalized)) !== null) {
    tables.add(match[1]!)
  }

// With:
  // Handles INSERT INTO, INSERT OR ..., and REPLACE INTO
  const insertOrReplaceRegex = /\b(?:insert\s+(?:or\s+\w+\s+)?|replace\s+)into\s+([a-z_][a-z0-9_]*)/gi
  while ((match = insertOrReplaceRegex.exec(normalized)) !== null) {
    tables.add(match[1]!)
  }
```

This single regex `/\b(?:insert\s+(?:or\s+\w+\s+)?|replace\s+)into\s+([a-z_][a-z0-9_]*)/gi` covers all `INSERT` and `REPLACE` variations that write to a table.

This is a minor suggestion; the original change is perfectly valid as-is.
