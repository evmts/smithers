# Code Review for Commit 1ba7404

**Date:** 2026-01-18 13:19:28
**Commit Message:** Refactor TUI components to use custom hooks for side-effects

- Create usePollEvents hook for ExecutionTimeline polling logic
- Create usePollTableData hook for DatabaseExplorer table loading
- Remove effect-based state machines, move scroll sync to keyboard handlers
- Replace clamp selection effect with derived clampedSelectedIndex
- Export new hooks from tui/hooks/index.ts

---

### Summary

The overall refactoring is a significant improvement. Extracting polling logic and side-effects into custom hooks (`usePollEvents`, `usePollTableData`) cleans up the components considerably and improves modularity. The changes in `ScrollableList.tsx` to remove effect-based state machines in favor of derived state and co-located keyboard/scroll logic are excellent and make the component easier to reason about.

However, there are a couple of issues that should be addressed.

### Issues Found

1.  **Extraneous File Included:**
    *   **File:** `reviews/20260118_131815_88da46c.md`
    *   **Issue:** This file is a code review for a different commit. It is unrelated to the current changes and adds noise to the commit history.

2.  **Error Handling Regression:**
    *   **File:** `src/tui/hooks/usePollTableData.ts` (new file)
    *   **Issue:** The original implementation in `DatabaseExplorer.tsx` wrapped the database queries in a `try...catch` block, which gracefully handled errors by clearing the table data. This error handling was removed in the new `usePollTableData` hook. If a database query fails, it will now cause an unhandled exception and crash the UI.

### Suggested Improvements

1.  Remove the unrelated review file (`reviews/20260118_131815_88da46c.md`) from this commit. It should be in its own commit or not at all if it's just a local artifact.
2.  Reinstate the `try...catch` block inside the `useEffect` of the `usePollTableData` hook to prevent crashes and ensure graceful error handling, like so:
    ```typescript
    // src/tui/hooks/usePollTableData.ts
    useEffect(() => {
      try {
        const pragmaResult = db.query<{ name: string }>(`PRAGMA table_info(${tableName})`);
        setColumns(pragmaResult.map(r => r.name));
        const data = db.query<Record<string, unknown>>(`SELECT * FROM ${tableName} ORDER BY rowid DESC LIMIT 100`);
        setData(data);
      } catch {
        setData([]);
        setColumns([]);
      }
    }, [db, tableName]);
    ```
