---
title: Worktree
description: Git worktree isolation for parallel branch execution
---

# Worktree

Isolate agents in separate git worktrees. Enables parallel branch execution and safe experimentation.

```tsx
<Worktree branch="feature-auth" cleanup>
  <Claude>Implement user authentication</Claude>
</Worktree>
```

All nested components automatically operate in the worktree directory.

## Parallel Development

```tsx
<Parallel>
  <Worktree branch="feature-a" cleanup>
    <Claude>Implement feature A</Claude>
  </Worktree>
  <Worktree branch="feature-b" cleanup>
    <Claude>Implement feature B</Claude>
  </Worktree>
</Parallel>
```

## Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `id` | `string?` | `branch` | Stable identifier for resumability |
| `branch` | `string` | required | Branch name. Created from `base` if doesn't exist |
| `base` | `string` | `"HEAD"` | Base ref when creating new branch |
| `path` | `string` | `.worktrees/${branch}` | Worktree directory path |
| `cleanup` | `boolean` | `false` | Remove worktree on unmount |
| `children` | `ReactNode` | required | Content rendered in worktree |
| `onReady` | `(path: string) => void` | - | Called when worktree is ready |
| `onError` | `(error: Error) => void` | - | Called on setup failure |

## Behavior Details

- **Git requirement**: Worktree requires a Git repository. The command fails if not in a Git repo.
- **Branch existence**: If `branch` already exists as a local branch, Worktree checks it out in the new worktree. To create from a specific ref, use the `base` prop.
- **Cleanup warning**: When `cleanup={true}`, the worktree directory is removed on unmount. Do not enable cleanup if you need to inspect output after the workflow completes.

## Context Propagation

```
┌────────────────────────────────────────────────┐
│  <Worktree branch="feature">                   │
│    WorktreeContext: { cwd, branch }            │
│         │                                      │
│         ├─► <Claude> → uses worktree cwd       │
│         ├─► <Command> → uses worktree cwd      │
│         └─► <Smithers> → uses worktree cwd     │
└────────────────────────────────────────────────┘
```

Children automatically operate in worktree. Use `useWorktree()` hook in custom components.

## Lifecycle

```
PENDING → READY → CLEANUP (if cleanup=true)
```

Worktrees persist across Ralph iterations. For per-iteration worktrees:

```tsx
<Worktree branch={`iteration-${ralphCount}`}>
```

## Related

<CardGroup cols={2}>
  <Card title="Claude" icon="robot" href="/components/claude">
    Respects worktree context
  </Card>
  <Card title="Parallel" icon="layer-group" href="/components/parallel">
    Run multiple worktrees concurrently
  </Card>
</CardGroup>
