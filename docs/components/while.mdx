---
title: While
description: Iterative loop component - provides iteration in Smithers workflows
---

# While

```tsx
import { While } from "smithers-orchestrator";
```

While provides iteration in Smithers workflows. Use it (or its alias [Ralph](/components/ralph)) to loop until a condition is met.

<Note>
Without While or Ralph, your workflow runs exactly once. Use While for iterative workflows like fix loops, phased plans, or retry patterns.
</Note>

```tsx
<While
  id="fix-and-retry"
  condition={async () => {
    const result = db.state.get<{ passed: boolean }>('testResult')
    return result?.passed !== true
  }}
  maxIterations={5}
>
  <Phase name="Fix and Retry">
    <Step name="Analyze"><Claude>Analyze test failures</Claude></Step>
    <Step name="Fix"><Claude>Apply targeted fix</Claude></Step>
    <Step name="Test"><Claude>Run test suite</Claude></Step>
  </Phase>
</While>
```

## Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `id` | `string` | required | Stable identifier for resumability |
| `condition` | `() => boolean \| Promise<boolean>` | required | Loop continues while true |
| `maxIterations` | `number` | `10` | Maximum iterations to prevent infinite loops |
| `children` | `ReactNode` | required | Components executed each iteration |
| `onIteration` | `(iteration: number) => void` | - | Callback at start of each iteration |
| `onComplete` | `(iterations, reason) => void` | - | Callback when loop completes (`reason: 'condition' | 'max'`) |

## State Machine

```
┌──────────────┐
│   PENDING    │
└──────┬───────┘
       │ mount
       ▼
┌──────────────┐
│   EVALUATE   │◄─────────────────────────┐
│   condition  │                          │
└──────┬───────┘                          │
       │                                  │
       ├─── true ──►┌──────────────┐      │
       │            │   RUNNING    │──────┘
       │            │   children   │  iteration++
       │            └──────────────┘
       │
       └─── false ──►┌──────────────┐
                     │   COMPLETE   │
                     └──────────────┘

Also: COMPLETE if iteration >= maxIterations
```

## Review-Fix Loop

```tsx
function ReviewFixLoop() {
  const { db } = useSmithers()

  return (
    <While
      id="review-loop"
      condition={async () => {
        const review = db.state.get<{ decision: string }>('lastReview')
        return review?.decision === 'request_changes'
      }}
      maxIterations={3}
    >
      <Phase name="Review">
        <Step name="review">
          <Claude
            schema={reviewSchema}
            onFinished={(result) => {
              db.state.set('lastReview', result.structured ?? result.output)
            }}
          >
            Review PR and provide structured feedback
          </Claude>
        </Step>
      </Phase>

      <Phase name="Fix">
        <Step name="fix">
          <Claude>Address review feedback and commit changes</Claude>
        </Step>
      </Phase>
    </While>
  )
}
```

## Polling Loop

```tsx
<While
  id="wait-for-ci"
  condition={async () => {
    const status = await fetch('/api/ci-status').then(r => r.json())
    return status.state === 'pending'
  }}
  maxIterations={30}
  onIteration={(i) => console.log(`Poll attempt ${i}`)}
>
  <Step name="Wait">
    <Claude>Check CI status and wait if still pending</Claude>
  </Step>
</While>
```

## Scoping

Each iteration gets isolated scope for re-execution:
- Iteration 0: `root.while.fix-tests.0`
- Iteration 1: `root.while.fix-tests.1`

This allows phases/steps to re-execute without state collision.

## Nested Loops

```tsx
<While id="outer" condition={() => !allFeaturesDone} maxIterations={10}>
  <Phase name="Select Feature">
    <Step name="select"><Claude>Pick next feature</Claude></Step>
  </Phase>

  <While id="inner" condition={() => !currentFeatureDone} maxIterations={5}>
    <Phase name="Implement">
      <Step name="impl"><Claude>Implement and test</Claude></Step>
    </Phase>
  </While>
</While>
```

Scoping: `root.while.outer.N.while.inner.M`

## Related

<CardGroup cols={2}>
  <Card title="If" icon="question" href="/components/if">
    Conditional execution
  </Card>
  <Card title="Ralph" icon="rotate" href="/components/ralph">
    Task-driven loop control
  </Card>
</CardGroup>
