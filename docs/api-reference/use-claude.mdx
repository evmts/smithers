---
title: useClaude Hook
description: Run Claude with DB-backed state for custom UI
---

# useClaude Hook

Runs the same execution pipeline as `<Claude>`, but returns state for custom rendering. The source of truth is the Smithers DB (agents table), not React state.

```tsx
import { useClaude } from "smithers-orchestrator";

function ClaudePanel() {
  const { status, result, error, tailLog, agentId } = useClaude({
    model: "sonnet",
    children: "Review the diff and suggest fixes.",
  });

  return (
    <panel>
      <text>Status: {status}</text>
      {agentId && <text>Agent: {agentId}</text>}
      {error && <text>Error: {error.message}</text>}
      {result && <text>Output: {result.output}</text>}
      {tailLog.length > 0 && <text>Tail: {tailLog.at(-1)?.content}</text>}
    </panel>
  );
}
```

## API

```tsx
function useClaude(props: ClaudeProps): UseClaudeResult

interface UseClaudeResult {
  status: "pending" | "running" | "complete" | "error"
  agentId: string | null
  executionId: string | null
  model: string
  result: AgentResult | null
  error: Error | null
  tailLog: TailLogEntry[]
}
```

## Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `children` | `ReactNode` | — | The prompt to send to Claude |
| `model` | `'opus' \| 'sonnet' \| 'haiku' \| string` | `'sonnet'` | Claude model to use |
| `permissionMode` | `'default' \| 'acceptEdits' \| 'plan' \| 'dontAsk' \| 'bypassPermissions'` | `'default'` | Permission mode for file operations |
| `mcpConfig` | `string` | — | Path to MCP configuration file |
| `allowedTools` | `string[]` | — | Specific tools to allow (whitelist) |
| `disallowedTools` | `string[]` | — | Specific tools to disallow (blacklist) |
| `maxTurns` | `number` | — | Maximum number of agentic loops |
| `maxTokens` | `number` | — | Maximum tokens for output |
| `timeout` | `number` | — | Timeout in milliseconds |
| `cwd` | `string` | — | Working directory for the agent |
| `systemPrompt` | `string` | — | System prompt for the agent |
| `outputFormat` | `'text' \| 'json' \| 'stream-json'` | `'text'` | Output format |
| `continueConversation` | `boolean` | — | Continue from previous conversation |
| `resumeSession` | `string` | — | Resume a specific session |
| `schema` | `z.ZodType` | — | Zod schema for structured output validation |
| `schemaRetries` | `number` | `2` | Maximum retries for schema validation failures |
| `validate` | `(result: AgentResult) => boolean \| Promise<boolean>` | — | Validate result before accepting |
| `retryOnValidationFailure` | `boolean` | — | Retry if validation fails |
| `maxRetries` | `number` | — | Maximum retry attempts |
| `retryDelayMs` | `number` | `250` | Base delay in milliseconds for retry backoff |
| `stopConditions` | `StopCondition[]` | — | Conditions that will stop the agent |
| `middleware` | `SmithersMiddleware[]` | — | Middleware applied to this execution |
| `tailLogCount` | `number` | `10` | Number of tail log entries to display during execution |
| `tailLogLines` | `number` | `10` | Number of lines to show per tail log entry |
| `useSubscription` | `boolean` | `true` | Use Claude subscription credits instead of API credits |
| `reportingEnabled` | `boolean` | — | Enable database reporting for this agent |
| `recordStreamEvents` | `boolean` | `true` when `reportingEnabled` | Record stream events to the database |
| `legacyLogFormat` | `boolean` | `false` | Write legacy raw text logs alongside NDJSON stream logs |
| `onFinished` | `(result: AgentResult) => void` | — | Called when agent finishes successfully |
| `onError` | `(error: Error) => void` | — | Called when agent encounters an error |
| `onProgress` | `(message: string) => void` | — | Called for progress updates |
| `onToolCall` | `(tool: string, input: any) => void` | — | Called when agent makes a tool call |
| `onStreamPart` | `(part: SmithersStreamPart) => void` | — | Called for typed stream events (when enabled) |

## Notes

- Requires `SmithersProvider` context.
- Respects `ExecutionScope` and `executionEnabled`.
- `tailLog` is in-memory; status/result come from the DB.

## Related

<CardGroup cols={2}>
  <Card title="Claude Component" icon="robot" href="/components/claude">
    JSX wrapper around the same execution
  </Card>
  <Card title="Agents API" icon="database" href="/api-reference/agents">
    DB schema and methods
  </Card>
</CardGroup>
