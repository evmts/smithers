---
title: Agents API
description: Track Claude agent invocations
---

# Agents API

```tsx
const agentId = db.agents.start("Implement the feature", "sonnet", "You are a senior engineer");
// ... agent runs ...
db.agents.complete(agentId, "Feature implemented", { success: true }, { input: 1000, output: 500 });
```

## Contract

- **Sync:** All methods are synchronous
- **Return shape:** snake_case fields with `Date` object timestamps
- **Status:** `pending | running | completed | failed | cancelled`

## Methods

| Method | Signature | Description |
|--------|-----------|-------------|
| `start` | `(prompt: string, model?: string, systemPrompt?: string, logPath?: string) => string` | Start agent |
| `complete` | `(id: string, result: string, structuredResult?: object, tokens?: {input, output}) => void` | Mark complete |
| `fail` | `(id: string, error: string) => void` | Mark failed |
| `setStreamSummary` | `(id: string, summary: StreamSummary) => void` | Set stream summary stats |
| `recordStreamEvent` | `(agentId: string, part: SmithersStreamPart) => void` | Record a stream event |
| `getStreamEvents` | `(agentId: string, options?: {types?: string[], limit?: number}) => AgentStreamEvent[]` | Get stream events |
| `current` | `() => Agent \| null` | Get running agent |
| `list` | `(executionId: string) => Agent[]` | List agents for execution |

## Tool Calls

```tsx
const toolId = db.tools.start(agentId, "Edit", { file: "src/main.ts" });
db.tools.complete(toolId, "File edited successfully", "Added 15 lines");
const tools = db.tools.list(agentId);
```

| Method | Signature | Description |
|--------|-----------|-------------|
| `tools.start` | `(agentId: string, toolName: string, input: object) => string` | Start tool call |
| `tools.complete` | `(id: string, output: string, summary?: string) => void` | Complete tool call |
| `tools.list` | `(agentId: string) => ToolCall[]` | List tool calls |

## Types

```tsx
interface Agent {
  id: string;
  execution_id: string;
  phase_id?: string;
  prompt: string;
  model: string;
  system_prompt?: string;
  status: "pending" | "running" | "completed" | "failed" | "cancelled";
  result?: string;
  result_structured?: Record<string, any>;
  error?: string;
  tokens_input?: number;
  tokens_output?: number;
  tool_calls_count: number;
  started_at?: Date;
  completed_at?: Date;
  duration_ms?: number;
  created_at: Date;
  log_path?: string;
  stream_summary?: StreamSummary;
}

interface StreamSummary {
  textBlocks: number;
  reasoningBlocks: number;
  toolCalls: number;
  toolResults: number;
  errors: number;
}

interface AgentStreamEvent {
  id: string;
  agent_id: string;
  event_type: string;
  event_id?: string;
  tool_name?: string;
  content?: string;
  timestamp: number;
  created_at: Date;
}

interface ToolCall {
  id: string;
  agent_id: string;
  tool_name: string;
  input: Record<string, any>;
  output_inline?: string;
  output_summary?: string;
  status: "pending" | "running" | "completed" | "failed";
  started_at?: Date;
  completed_at?: Date;
  duration_ms?: number;
  created_at: Date;
}
```

## Related

- [Execution API](/api-reference/execution)
- [Claude Component](/components/claude)
