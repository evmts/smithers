---
title: Reactive Hooks
description: React hooks for reactive SQLite queries
---

# Reactive Hooks

```tsx
import { useQuery, useQueryOne, useQueryValue, useMutation } from "smithers-orchestrator/reactive-sqlite";

function UserList() {
  const { data: users } = useQuery(db, "SELECT * FROM users WHERE active = ?", [true]);
  const { data: count } = useQueryValue<number>(db, "SELECT COUNT(*) FROM users");
  const { mutate } = useMutation(db, "INSERT INTO users (name) VALUES (?)");
  
  return <ul>{users.map(u => <li key={u.id}>{u.name}</li>)}</ul>;
}
```

Queries auto re-run when tables are mutated.

## useQuery

```tsx
function useQuery<T>(
  db: ReactiveDatabase,
  sql: string,
  params?: any[],
  options?: { skip?: boolean; deps?: any[] }
): { data: T[]; isLoading: boolean; error: Error | null; refetch: () => void }
```

## useQueryOne

Single row. Returns `null` if not found.

```tsx
function useQueryOne<T>(
  db: ReactiveDatabase,
  sql: string,
  params?: any[],
  options?: { skip?: boolean; deps?: any[] }
): { data: T | null; isLoading: boolean; error: Error | null; refetch: () => void }
```

## useQueryValue

Single value extraction.

```tsx
function useQueryValue<T>(
  db: ReactiveDatabase,
  sql: string,
  params?: any[],
  options?: { skip?: boolean; deps?: any[] }
): { data: T | null; isLoading: boolean; error: Error | null; refetch: () => void }
```

## useMutation

```tsx
function useMutation<TParams extends any[]>(
  db: ReactiveDatabase,
  sql: string,
  options?: { invalidateTables?: string[]; onSuccess?: () => void; onError?: (e: Error) => void }
): { mutate: (...params: TParams) => void; mutateAsync: (...params: TParams) => Promise<void>; isLoading: boolean; error: Error | null }
```

## How Reactivity Works

1. SQL parser extracts table names
2. `useQuery` subscribes to relevant tables
3. `db.run()` notifies subscribers
4. Affected queries re-run

```tsx
const { data } = useQuery(db, "SELECT * FROM users");  // Subscribes to 'users'
db.run("INSERT INTO users (name) VALUES (?)", ["Alice"]);  // Triggers re-run
```

## DatabaseProvider

Optional implicit db access:

```tsx
<DatabaseProvider db={db}>
  <UserList />  {/* useQuery("SELECT ...") without db param */}
</DatabaseProvider>
```

## Best Practices

- Select specific columns to minimize re-renders
- Use `skip: true` for conditional queries
- Use `useQueryOne` for single rows, `useQueryValue` for scalars

## Related

<CardGroup cols={2}>
  <Card title="Database API" icon="database" href="/api-reference/database" />
  <Card title="State API" icon="toggle-on" href="/api-reference/state" />
</CardGroup>
