---
title: Steps API
description: Step tracking within workflow phases
---

# Steps API

```tsx
const stepId = db.steps.start("implement-feature");
// ... do work ...
db.steps.complete(stepId, {
  snapshot_before: "abc123",
  snapshot_after: "def456",
  commit_created: "ghi789",
});
```

## Contract

- **Sync:** All methods are synchronous
- **Return shape:** snake_case fields, timestamps as ISO strings

## Methods

| Method | Signature | Description |
|--------|-----------|-------------|
| `start` | `(name?: string) => string` | Start a step |
| `complete` | `(id: string, vcsInfo?: VcsInfo) => void` | Complete with optional VCS info |
| `fail` | `(id: string) => void` | Mark failed |
| `current` | `() => Step \| null` | Get active step |
| `list` | `(phaseId: string) => Step[]` | List steps for phase |
| `getByExecution` | `(executionId: string) => Step[]` | List steps for execution |

### VcsInfo

```tsx
interface VcsInfo {
  snapshot_before?: string;  // JJ change ID before
  snapshot_after?: string;   // JJ change ID after
  commit_created?: string;   // Commit hash if created
}
```

## Component Usage

```tsx
<Phase name="implementation">
  <Step name="setup-database">
    <Claude>Set up the database schema.</Claude>
  </Step>

  <Step name="implement-api">
    <Claude>Implement the API endpoints.</Claude>
  </Step>
</Phase>
```

## VCS Tracking

```tsx
async function trackedStep() {
  const beforeSnapshot = await jjSnapshot("Before refactoring");
  const stepId = db.steps.start("refactoring");

  try {
    // do work...
    const afterSnapshot = await jjSnapshot("After refactoring");
    db.steps.complete(stepId, {
      snapshot_before: beforeSnapshot.changeId,
      snapshot_after: afterSnapshot.changeId,
    });
  } catch (error) {
    db.steps.fail(stepId);
    throw error;
  }
}
```

## Types

```tsx
interface Step {
  id: string;
  execution_id: string;
  phase_id?: string;
  name?: string;
  status: 'pending' | 'running' | 'completed' | 'failed' | 'skipped';
  started_at?: string;
  completed_at: string | null;
  duration_ms?: number | null;
  snapshot_before?: string | null;
  snapshot_after?: string | null;
  commit_created?: string | null;
  created_at: string;
}
```

## Related

- [Phases API](/api-reference/phases)
- [Step Component](/components/step)
