---
title: Lifecycle Hooks
description: Mount, unmount, and async-safe state hooks
---

# Lifecycle Hooks

```tsx
import { 
  useMount, 
  useUnmount, 
  useMountedState,
  useEffectOnce,
  useFirstMountState,
  useExecutionGate,
  ExecutionGateProvider,
  useExecutionMount
} from "smithers-orchestrator";

function MyComponent() {
  const isMounted = useMountedState();
  
  useMount(() => {
    fetchData().then(result => {
      if (isMounted()) db.state.set("data", result);
    });
  });
  
  useUnmount(() => cleanup());
}
```

## useMount

Runs once on mount. Uses idempotency guard for strict mode.

```tsx
function useMount(fn: () => void): void
```

## useUnmount

Cleanup on unmount. Uses ref to avoid stale closures.

```tsx
function useUnmount(fn: () => void): void
```

```tsx
// ❌ Stale closure
useEffect(() => {
  const id = startTask();
  return () => completeTask(id); // May be stale
}, []);

// ✅ Always current
const idRef = useRef<string | null>(null);
useMount(() => { idRef.current = startTask(); });
useUnmount(() => { completeTask(idRef.current); });
```

## useMountedState

Returns getter for current mount state. Prevents setState on unmounted components.

```tsx
function useMountedState(): () => boolean
```

## useEffectOnce

Runs effect only once on mount. Wrapper around `useEffect` with empty deps.

```tsx
function useEffectOnce(effect: EffectCallback): void
```

```tsx
useEffectOnce(() => {
  console.log("Runs once on mount");
  return () => console.log("Cleanup on unmount");
});
```

## useFirstMountState

Returns `true` on first render, `false` on subsequent renders. Useful for conditional first-mount logic.

```tsx
function useFirstMountState(): boolean
```

```tsx
const isFirstMount = useFirstMountState();
if (isFirstMount) {
  initializeOnce();
}
```

## useExecutionGate

Returns current execution gate state from context. Used internally by `useMount`/`useUnmount` to prevent execution during disabled phases.

```tsx
function useExecutionGate(): boolean
```

## ExecutionGateProvider

Provides execution gate context to children. When `enabled` is false, gated hooks (`useMount`, `useUnmount`, `useEffectOnValueChange`) won't execute.

```tsx
interface ExecutionGateProviderProps {
  enabled: boolean;
  children: ReactNode;
}

function ExecutionGateProvider(props: ExecutionGateProviderProps): ReactNode
```

```tsx
<ExecutionGateProvider enabled={shouldExecute}>
  <MyComponent /> {/* useMount won't fire if shouldExecute is false */}
</ExecutionGateProvider>
```

## useExecutionMount

Runs effect once when `executionEnabled` becomes true. Idempotent—won't re-run even if deps change after first execution.

```tsx
function useExecutionMount(
  executionEnabled: boolean,
  fn: () => void,
  deps?: DependencyList
): void
```

```tsx
const isReady = useQueryValue(db, "SELECT ready FROM state");
useExecutionMount(isReady, () => {
  startTask(); // Runs once when isReady becomes true
});
```

## useEffectOnValueChange

Runs effect when value changes with idempotency. Won't run twice for same value.

```tsx
function useEffectOnValueChange<T>(
  value: T,
  effect: () => void | (() => void),
  deps?: DependencyList
): void
```

```tsx
const ralphCount = useRalphCount();
useEffectOnValueChange(ralphCount, () => executeTask());
```

## When to Use

| Hook | Use Case |
|------|----------|
| `useMount` | One-time setup on mount |
| `useUnmount` | Cleanup needing latest state |
| `useMountedState` | Async operations setting state |
| `useEffectOnce` | Simple one-time effect |
| `useFirstMountState` | Conditional first-mount logic |
| `useExecutionGate` | Check if execution is enabled |
| `ExecutionGateProvider` | Control execution for subtree |
| `useExecutionMount` | Run once when enabled |
| `useEffectOnValueChange` | Re-run on value change with idempotency |
| `useEffect` | Standard React effect behavior |

## Related

<CardGroup cols={2}>
  <Card title="Smithers Hooks" icon="hook" href="/api-reference/hooks" />
  <Card title="Reactive Hooks" icon="bolt" href="/api-reference/reactive-hooks" />
</CardGroup>
