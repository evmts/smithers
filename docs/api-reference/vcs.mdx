---
title: VCS API
description: Version control operations tracking
---

# VCS API

```tsx
db.vcs.logCommit({
  vcs_type: "git",
  commit_hash: "abc123def",
  message: "feat: Add user authentication",
  files_changed: ["src/auth.ts"],
  insertions: 150,
  deletions: 20,
});
```

## Contract

- **Sync:** All methods are synchronous
- **Return shape:** snake_case fields with `Date` timestamps
- **Scope:** Lists scoped to current execution

## Commits

| Method | Signature | Description |
|--------|-----------|-------------|
| `logCommit` | `(data: CommitData) => string` | Log a commit |
| `getCommits` | `(limit?: number) => Commit[]` | List recent commits |
| `getCommit` | `(hash: string, vcsType?: 'git' \| 'jj') => Commit \| null` | Get by hash |

## Snapshots

| Method | Signature | Description |
|--------|-----------|-------------|
| `logSnapshot` | `(data: SnapshotData) => string` | Log a JJ snapshot |
| `getSnapshots` | `(limit?: number) => Snapshot[]` | List snapshots |

```tsx
db.vcs.logSnapshot({
  change_id: "CXYZ789",
  description: "Before refactoring",
  files_modified: ["src/auth.ts"],
  has_conflicts: false,
});
```

## Reviews

| Method | Signature | Description |
|--------|-----------|-------------|
| `logReview` | `(data: ReviewData) => string` | Log a review |
| `updateReview` | `(id: string, flags: object) => void` | Update publish flags |
| `getReviews` | `(limit?: number) => Review[]` | List reviews |
| `getBlockingReviews` | `() => Review[]` | Get blocking reviews |

```tsx
db.vcs.logReview({
  target_type: "commit",
  target_ref: "abc123def",
  approved: false,
  summary: "Security issues found",
  issues: [{ severity: "critical", file: "src/auth.ts", line: 42, message: "SQL injection" }],
  blocking: true,
});
```

## Reports

| Method | Signature | Description |
|--------|-----------|-------------|
| `addReport` | `(data: ReportData) => string` | Add a report |
| `getReports` | `(type?: string, limit?: number) => Report[]` | List reports |
| `getCriticalReports` | `() => Report[]` | Get critical reports |

```tsx
db.vcs.addReport({
  type: "progress",
  severity: "info",
  title: "Phase Complete",
  content: "Research phase done",
});
```

## Types

```tsx
interface Commit {
  id: string;
  execution_id: string;
  agent_id?: string;
  vcs_type: "git" | "jj";
  commit_hash: string;
  change_id?: string;
  message: string;
  author?: string;
  files_changed?: string[];
  insertions?: number;
  deletions?: number;
  smithers_metadata?: Record<string, any>;
  created_at: Date;
}

interface Snapshot {
  id: string;
  execution_id: string;
  change_id: string;
  commit_hash?: string;
  description?: string;
  files_modified?: string[];
  files_added?: string[];
  files_deleted?: string[];
  has_conflicts: boolean;
  created_at: Date;
}

interface Review {
  id: string;
  execution_id: string;
  agent_id?: string;
  target_type: "commit" | "diff" | "pr" | "files";
  target_ref?: string;
  approved: boolean;
  summary: string;
  issues: { severity: string; file?: string; line?: number; message: string }[];
  approvals?: { reviewer: string; approved: boolean; comment?: string }[];
  reviewer_model?: string;
  blocking: boolean;
  posted_to_github: boolean;
  posted_to_git_notes: boolean;
  created_at: Date;
}

interface Report {
  id: string;
  execution_id: string;
  agent_id?: string;
  type: "progress" | "finding" | "warning" | "error" | "metric" | "decision";
  title: string;
  content: string;
  data?: Record<string, any>;
  severity: "info" | "warning" | "critical";
  created_at: Date;
}
```

## Related

- [Commit Component](/components/commit)
- [Review Component](/components/review)
