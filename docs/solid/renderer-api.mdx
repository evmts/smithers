---
title: Solid Renderer API
description: Renderer contract for solid-smithers and SmithersNode behavior
---

# Solid Renderer API

This document defines the minimal renderer contract needed for a Solid-based Smithers renderer. The renderer must build a SmithersNode tree that can be serialized to the existing XML plan format.

## SmithersNode Contract

```ts
interface SmithersNode {
  type: string
  props: Record<string, unknown>
  children: SmithersNode[]
  parent: SmithersNode | null
  _execution?: ExecutionState
}
```

### Invariants

- `children` order is significant and must be stable.
- `TEXT` nodes must store string content in `props.value`.
- `parent` links must be kept in sync with child insertion/removal.
- Function props are allowed but should be ignored by serialization and hashing.

## Required Renderer Operations

Use `createRenderer` from `solid-js/universal` and implement these operations:

| Operation | Responsibility |
| --- | --- |
| `createElement(type)` | Create a SmithersNode with `type` and empty props/children |
| `createTextNode(value)` | Create a `TEXT` node with `props.value` |
| `replaceText(node, value)` | Update text content |
| `setProperty(node, name, value)` | Mutate `node.props` |
| `insertNode(parent, node, anchor)` | Insert child into `parent.children` |
| `removeNode(parent, node)` | Remove child from `parent.children` |
| `getParentNode(node)` | Return `node.parent` |
| `getFirstChild(node)` | Return first child or null |
| `getNextSibling(node)` | Return next sibling or null |
| `isTextNode(node)` | Return true if `node.type === "TEXT"` |

### Suggested Behavior

```ts
function insertNode(parent, node, anchor) {
  node.parent = parent
  if (!anchor) {
    parent.children.push(node)
    return
  }
  const index = parent.children.indexOf(anchor)
  if (index === -1) {
    parent.children.push(node)
    return
  }
  parent.children.splice(index, 0, node)
}
```

## Host Element Mapping

All Smithers components map to lowercase host types:

| Component | Host Type |
| --- | --- |
| `<Claude>` | `claude` |
| `<Subagent>` | `subagent` |
| `<Phase>` | `phase` |
| `<Step>` | `step` |
| `<Persona>` | `persona` |
| `<Constraints>` | `constraints` |
| `<OutputFormat>` | `output-format` |
| `<Stop>` | `stop` |
| `<Human>` | `human` |
| `<Output>` | `output` |
| `<File>` | `file` |
| `<Worktree>` | `worktree` |

## Integration with Smithers Core

- The renderer should return a `SmithersNode` root tree.
- `renderPlan()` calls `serialize(root)` to produce XML.
- `executePlan()` consumes the same tree; no changes needed.

## Test Cases

Minimal renderer test cases to validate correctness:

1. **Text updates**: signal toggles between two strings.
2. **Conditional branches**: show/hide child subtree.
3. **Lists + keys**: stable child ordering on insert/remove.
4. **Nested elements**: `Phase` with `Step` children.
5. **Props updates**: change `props.completed` and verify hash changes.
