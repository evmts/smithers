---
title: "MCP Integration"
description: "Using Model Context Protocol servers for external tool capabilities"
---

# MCP Integration

Demonstrates integrating MCP (Model Context Protocol) servers to extend Claude's capabilities with external tools.

## What This Example Shows

- Connecting to MCP servers with built-in presets
- Using filesystem, SQLite, and GitHub MCP servers
- Scoped tool access per agent
- Multiple MCP servers in one workflow
- Custom MCP server configuration

## The Code

```tsx
import { executePlan, Claude } from 'smithers'
import { filesystem, sqlite, github } from 'smithers/mcp'

// Example 1: Filesystem Operations
function FilesystemDemo() {
  return (
    <Claude
      mcpServers={[
        filesystem({
          allowedPaths: ['./data', './output']
        })
      ]}
      allowedTools={['read_file', 'write_file', 'list_directory']}
    >
      1. List all files in ./data directory
      2. Read data/users.json
      3. Process the user data (add timestamps)
      4. Write results to ./output/processed-users.json
    </Claude>
  )
}

// Example 2: SQLite Database
function SQLiteDemo() {
  return (
    <Claude
      mcpServers={[
        sqlite({
          databases: {
            main: './app.db'
          }
        })
      ]}
      allowedTools={['query', 'execute']}
    >
      1. Query all users: SELECT * FROM users WHERE active = 1
      2. Calculate total revenue
      3. Create summary report
    </Claude>
  )
}

// Example 3: GitHub Operations
function GitHubDemo() {
  return (
    <Claude
      mcpServers={[
        github({
          owner: 'myorg',
          repo: 'myrepo',
          token: process.env.GITHUB_TOKEN
        })
      ]}
      allowedTools={['list_issues', 'create_issue', 'list_prs']}
    >
      1. List open issues labeled "bug"
      2. For each bug:
         - Analyze the issue description
         - Check if there's an existing PR
         - If no PR, suggest a fix plan
      3. Create a summary report
    </Claude>
  )
}

// Example 4: Multiple MCP Servers
function MultiServerDemo() {
  return (
    <Claude
      mcpServers={[
        filesystem({ allowedPaths: ['./data'] }),
        sqlite({ databases: { main: './app.db' } })
      ]}
    >
      1. Read ./data/sales.json
      2. Insert sales data into database
      3. Query aggregated stats
      4. Write report to ./data/report.md
    </Claude>
  )
}

// CLI execution
const demo = process.argv[2] || 'filesystem'

console.log(`ðŸ”Œ MCP Integration Demo: ${demo}`)

const demos = {
  filesystem: <FilesystemDemo />,
  sqlite: <SQLiteDemo />,
  github: <GitHubDemo />,
  multi: <MultiServerDemo />
}

await executePlan(demos[demo] || demos.filesystem)

console.log('âœ… MCP Demo Complete')
```

## Running

### Filesystem Demo

```bash
bun run examples/10-mcp-integration/agent.tsx filesystem
```

### SQLite Demo

```bash
# First, create database
sqlite3 app.db < schema.sql

# Run demo
bun run examples/10-mcp-integration/agent.tsx sqlite
```

### GitHub Demo

```bash
# Set GitHub token
export GITHUB_TOKEN=ghp_...

# Run demo
bun run examples/10-mcp-integration/agent.tsx github
```

### Multiple Servers

```bash
bun run examples/10-mcp-integration/agent.tsx multi
```

## Key Concepts

### Built-in MCP Presets

Smithers provides convenient presets for common MCP servers:

```tsx
import { filesystem, sqlite, github, git, memory, fetch } from 'smithers/mcp'
```

Each preset configures an MCP server with sensible defaults.

### MCP Server Configuration

Connect to MCP servers via the `mcpServers` prop:

```tsx
<Claude
  mcpServers={[
    filesystem({ allowedPaths: ['./data'] })
  ]}
>
  Use filesystem tools
</Claude>
```

The MCP server is automatically connected, and its tools become available to Claude.

### Tool Scoping

Control which MCP tools are available:

```tsx
<Claude
  mcpServers={[filesystem()]}
  allowedTools={['read_file', 'write_file']}  // Only these tools
>
  Can read and write, but not list or delete
</Claude>
```

This prevents unintended tool usage.

### Tool Name Collisions

If an inline tool and MCP tool have the same name, the inline tool wins:

```tsx
<Claude
  mcpServers={[filesystem()]}
  tools={[
    {
      name: 'read_file',
      description: 'Custom read with validation',
      execute: async (input) => { /* custom logic */ }
    }
  ]}
>
  Uses custom read_file, not MCP's read_file
</Claude>
```

## Available MCP Presets

### 1. Filesystem

```tsx
filesystem({
  allowedPaths: ['./data', './output'],  // Optional: restrict paths
  readOnly: false                         // Optional: read-only mode
})
```

Tools: `read_file`, `write_file`, `list_directory`, `delete_file`, `move_file`

### 2. SQLite

```tsx
sqlite({
  databases: {
    main: './app.db',
    analytics: './analytics.db'
  }
})
```

Tools: `query`, `execute`, `list_tables`, `describe_table`

### 3. GitHub

```tsx
github({
  owner: 'myorg',
  repo: 'myrepo',
  token: process.env.GITHUB_TOKEN
})
```

Tools: `list_issues`, `create_issue`, `list_prs`, `create_pr`, `list_commits`

### 4. Git

```tsx
git({
  repoPath: './'
})
```

Tools: `status`, `log`, `diff`, `branch`, `commit`

### 5. Memory

```tsx
memory({
  persistent: true,         // Save to disk
  storagePath: './memory'   // Storage location
})
```

Tools: `remember`, `recall`, `forget`, `list_memories`

### 6. Fetch

```tsx
fetch({
  allowedDomains: ['api.example.com'],
  timeout: 10000  // 10 seconds
})
```

Tools: `http_get`, `http_post`, `http_put`, `http_delete`

### 7. Custom MCP Server

```tsx
custom({
  command: 'python',
  args: ['mcp_server.py'],
  cwd: './servers'
})
```

Or via HTTP:

```tsx
http({
  url: 'http://localhost:3000/mcp'
})
```

## Use Cases

### 1. File Processing Pipeline

```tsx
<Claude mcpServers={[filesystem({ allowedPaths: ['./data'] })]}>
  1. List all JSON files in ./data
  2. Read and validate each file
  3. Transform data
  4. Write to ./data/processed/
</Claude>
```

### 2. Database Reports

```tsx
<Claude mcpServers={[sqlite({ databases: { main: './db.sqlite' } })]}>
  Generate monthly revenue report:
  1. Query sales by month
  2. Calculate totals and averages
  3. Format as markdown table
</Claude>
```

### 3. GitHub Automation

```tsx
<Claude mcpServers={[github({ owner, repo, token })]}>
  Triage new issues:
  1. List issues created today
  2. Analyze each issue
  3. Add labels based on content
  4. Assign to appropriate team member
</Claude>
```

### 4. Multi-Source Data Integration

```tsx
<Claude
  mcpServers={[
    filesystem({ allowedPaths: ['./data'] }),
    sqlite({ databases: { main: './db.sqlite' } }),
    fetch({ allowedDomains: ['api.example.com'] })
  ]}
>
  1. Fetch latest data from API
  2. Read local reference data
  3. Merge with database records
  4. Generate consolidated report
</Claude>
```

## Extending This Example

### Add Custom MCP Server

Create a custom MCP server in Python:

```python
# mcp_server.py
from mcp import MCPServer

server = MCPServer()

@server.tool()
def custom_tool(input: str) -> str:
    # Your custom logic
    return f"Processed: {input}"

server.run()
```

Use it in Smithers:

```tsx
import { custom } from 'smithers/mcp'

<Claude mcpServers={[custom({ command: 'python', args: ['mcp_server.py'] })]}>
  Use custom_tool to process data
</Claude>
```

### Add Error Handling

```tsx
<Claude
  mcpServers={[filesystem()]}
  onError={(error) => {
    if (error.message.includes('permission denied')) {
      console.error('File access error:', error)
      setPhase('retry-with-different-path')
    }
  }}
>
  Read sensitive files with error handling
</Claude>
```

### Add Rate Limiting

```tsx
import { ClaudeProvider } from 'smithers'

<ClaudeProvider rateLimit={{ requestsPerMinute: 30 }}>
  <Claude mcpServers={[github({ owner, repo, token })]}>
    Process 100 issues (respects GitHub rate limits)
  </Claude>
</ClaudeProvider>
```

## Security Considerations

### 1. Path Restrictions

Always restrict filesystem access:

```tsx
filesystem({
  allowedPaths: ['./data'],  // Only ./data directory
  readOnly: true             // Prevent modifications
})
```

### 2. API Token Security

Never hardcode tokens:

```tsx
// Bad
github({ token: 'ghp_...' })

// Good
github({ token: process.env.GITHUB_TOKEN })
```

### 3. Tool Allowlisting

Only enable needed tools:

```tsx
<Claude
  mcpServers={[filesystem()]}
  allowedTools={['read_file']}  // No write/delete
>
  Read-only operations
</Claude>
```

### 4. Input Validation

Validate MCP tool inputs before execution.

## Related Examples

- [06-file-processor](/examples/06-file-processor) - File transformation pipeline
- [11-rate-limited-batch](/examples/11-rate-limited-batch) - Batch processing with rate limits
- [07-git-helper](/examples/07-git-helper) - Git operations via Bash

## Learn More

- [MCP Integration Guide](/guides/mcp-integration)
- [ClaudeProvider Component](/components/claude-provider)
- [Tool Documentation](/components/claude#tools)
