---
title: Structured Output
description: Get typed, validated responses with Zod schemas
---

# Structured Output

```tsx
#!/usr/bin/env smithers

import { z } from "zod";
import {
  createSmithersRoot,
  createSmithersDB,
  SmithersProvider,
  Claude,
} from "smithers-orchestrator";

const AnalysisSchema = z.object({
  summary: z.string().describe("Brief summary of the analysis"),
  issues: z.array(z.object({
    severity: z.enum(["low", "medium", "high", "critical"]),
    file: z.string(),
    line: z.number().optional(),
    description: z.string(),
    suggestion: z.string().optional(),
  })),
  recommendations: z.array(z.string()),
  score: z.number().min(0).max(100).describe("Overall code quality score"),
});

type Analysis = z.infer<typeof AnalysisSchema>;

async function main() {
  const db = createSmithersDB({ path: ".smithers/analysis" });
  const executionId = db.execution.start("Code Analysis", "analysis.tsx");
  let analysisResult: Analysis | null = null;

  function AnalysisWorkflow() {
    return (
      <SmithersProvider db={db} executionId={executionId}>
        <Claude
          model="sonnet"
          schema={AnalysisSchema}
          schemaRetries={2}
          allowedTools={["Read", "Glob", "Grep"]}
          onFinished={(result) => {
            const analysis = result.structured;
            if (!analysis) return;
            analysisResult = analysis;

            console.log(`\nScore: ${analysis.score}/100`);
            console.log(`Summary: ${analysis.summary}\n`);
            for (const issue of analysis.issues) {
              console.log(`[${issue.severity}] ${issue.file}: ${issue.description}`);
            }
          }}
        >
          Analyze codebase for security, performance, and maintainability.
          Return structured analysis.
        </Claude>
      </SmithersProvider>
    );
  }

  try {
    const root = createSmithersRoot();
    await root.mount(<AnalysisWorkflow />);
    db.execution.complete(executionId, { summary: "Analysis complete", output: analysisResult });
  } catch (err) {
    const error = err instanceof Error ? err : new Error(String(err));
    db.execution.fail(executionId, error.message);
    throw error;
  } finally {
    db.close();
  }
}

main();
```

## Run It

```bash
bun analysis.tsx
```

## Output

```
Score: 72/100
Summary: Good practices overall but some security concerns.

[high] src/auth.ts: SQL query with string concatenation
[medium] src/api/users.ts: No input validation
[low] src/utils/helpers.ts: Unused import
```

## What's Happening

- **schema**: Zod schema enforces response structure
- **result.structured**: Typed, validated output
- **schemaRetries**: Retries on schema validation failure
- **describe()**: Guides Claude on field semantics

## Schema Tips

```tsx
// Use descriptions for guidance
const Schema = z.object({
  severity: z.enum(["low", "high"]).describe("Impact level"),
  confidence: z.number().min(0).max(1).describe("Confidence 0-1"),
});

// Custom validation in onFinished
<Claude
  schema={Schema}
  schemaRetries={2}
  onFinished={(result) => {
    if (result.structured?.score && result.structured.score <= 100) {
      console.log("Valid analysis received");
    }
  }}
>
```
