---
title: Monitoring & Logs
description: Smithers logging system, NDJSON streams, and output summarization
---

# Monitoring & Logs

Smithers provides structured logging for debugging and observability.

## Log Directory Layout

By default, logs are written to `.smithers/logs/`. When an execution ID is provided, logs are scoped:

```
.smithers/
├── logs/                          # Default log directory
│   └── <session-id>-001-*.txt     # Numbered log files
└── executions/
    └── <execution-id>/
        └── logs/                  # Execution-scoped logs
            ├── stream.ndjson      # NDJSON stream events
            └── stream.summary.json # Event counts
```

## NDJSON Stream Format

Stream events are logged as newline-delimited JSON:

```json
{"timestamp":1234567890,"type":"text-end","content":"..."}
{"timestamp":1234567891,"type":"tool-call","name":"Read","input":{...}}
{"timestamp":1234567892,"type":"tool-result","output":"..."}
```

### Event Types

| Type | Description |
|------|-------------|
| `text-end` | Completed text block |
| `reasoning-end` | Completed reasoning block |
| `tool-call` | Tool invocation |
| `tool-result` | Tool output |
| `error` | Error event |

### Summary Files

After stream completion, a summary is written:

```json
{
  "textBlocks": 5,
  "reasoningBlocks": 2,
  "toolCalls": 12,
  "toolResults": 12,
  "errors": 0
}
```

## Summarization

For large outputs, Smithers can summarize content using Claude Haiku.

### Configuration

| Environment Variable | Default | Description |
|---------------------|---------|-------------|
| `ANTHROPIC_API_KEY` | - | Required for AI summarization |
| `SMITHERS_SUMMARY_THRESHOLD` | `50` | Line count threshold for summarization |
| `SMITHERS_SUMMARY_CHAR_THRESHOLD` | `4000` | Character threshold for summarization |
| `SMITHERS_SUMMARY_MAX_CHARS` | `20000` | Max chars sent to summarizer |
| `SMITHERS_SUMMARY_MODEL` | `claude-3-haiku-20240307` | Model for summarization |

### Fallback Behavior

If `ANTHROPIC_API_KEY` is not set, outputs are truncated instead of summarized:

```
[first 500 chars]
[... truncated, see full output]
```

## LogWriter API

```tsx
import { LogWriter } from 'smithers-orchestrator/monitor'

const logger = new LogWriter('.smithers/logs', executionId)

// Write a log file
logger.writeLog('agent-output', content, { agent: 'claude' })

// Append to persistent stream
logger.appendLog('stream.log', 'new content')

// Write NDJSON stream part
logger.appendStreamPart('events.ndjson', {
  type: 'tool-call',
  name: 'Read',
  input: { file: 'src/main.ts' }
})

// Write summary
logger.writeStreamSummary('events', parts)

// Cleanup
await logger.flushAllStreams()
```

## Inspecting Logs

```bash
# View NDJSON stream
cat .smithers/executions/<id>/logs/stream.ndjson | jq

# View summary
cat .smithers/executions/<id>/logs/stream.summary.json

# Tail logs during execution
tail -f .smithers/logs/*.txt
```

## Related

<CardGroup cols={2}>
  <Card title="Debugging Playbook" icon="bug" href="/guides/debugging">
    Troubleshooting workflows
  </Card>
  <Card title="Database Persistence" icon="database" href="/concepts/database-persistence">
    State storage
  </Card>
</CardGroup>
