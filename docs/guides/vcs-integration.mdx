---
title: VCS Integration
description: Git and Jujutsu version control integration
---

# VCS Integration

```tsx
<Commit message="feat: Add auth" all notes={{ smithers: true }} />
```

## Auto-Generated Messages

```tsx
<Commit autoGenerate all />
```

## Selective Commits

```tsx
<Commit message="fix: Update config" files={["config.json", "settings.ts"]} />
```

## Git Notes

```tsx
<Commit
  message="feat: New feature"
  notes={{ smithers: true, executionId, prompt: "Implement feature" }}
/>
```

Read with `git notes show HEAD`.

## State Serialization

`db.state.get/set` handles primitives directly:

```tsx
// Strings and numbers work directly
db.state.set("phase", "implement");
db.state.set("retryCount", 3);

const phase = db.state.get("phase"); // "implement"
const count = db.state.get("retryCount"); // 3 (returned as number)
```

For complex objects, use JSON explicitly:

```tsx
// Storing objects requires JSON.stringify
db.state.set("config", JSON.stringify({ timeout: 5000, retries: 3 }));

// Reading objects requires JSON.parse
const configJson = db.state.get("config");
const config = configJson ? JSON.parse(configJson) : { timeout: 1000, retries: 1 };
```

## Complete Workflow

```tsx
import { useQueryValue } from "smithers-orchestrator/db";

function FeatureWorkflowBody() {
  const { db, reactiveDb } = useSmithers();
  
  // Phase is a simple string - no JSON parsing needed
  const phase = useQueryValue<string>(
    reactiveDb, "SELECT value FROM state WHERE key = 'phase'"
  ) ?? "implement";

  return (
    <>
      <If condition={phase === "implement"}>
        <Claude
          allowedTools={["Edit", "Write"]}
          onFinished={() => db.state.set("phase", "review")}
        >
          Implement the feature.
        </Claude>
      </If>

      <If condition={phase === "review"}>
        <Review
          target={{ type: "diff", ref: "main" }}
          criteria={["No security issues", "Tests pass"]}
          onFinished={(r) => db.state.set("phase", r.approved ? "commit" : "implement")}
        />
      </If>

      <If condition={phase === "commit"}>
        <Commit autoGenerate all onFinished={() => db.state.set("phase", "done")} />
      </If>
    </>
  );
}
```

## Jujutsu Snapshots

```tsx
import { Snapshot } from 'smithers/components/JJ'

// Create snapshot before risky operations
<Snapshot message="Before refactoring" />
```

The `<Snapshot>` component automatically:
- Creates a JJ snapshot via `jj new`
- Logs snapshot metadata to `db.vcs`
- Tracks file status (modified/added/deleted)

> **Note:** Snapshot restore functionality is planned but not yet implemented.
> For now, restore manually via `jj edit <change-id>`.

## Database Tracking

```tsx
db.vcs.logCommit({
  hash: "abc123",
  message: "feat: Add feature",
  author: "claude",
  timestamp: new Date(),
  filesChanged: 5,
  insertions: 100,
  deletions: 20,
  vcsType: "git",
});

const commits = db.vcs.getCommits(10);
```

## Related

<CardGroup cols={2}>
  <Card title="Commit Component" icon="code-commit" href="/components/commit" />
  <Card title="Review Component" icon="magnifying-glass" href="/components/review" />
</CardGroup>
