---
title: VCS Integration
description: Git and Jujutsu version control integration
---

# VCS Integration Guide

Smithers has first-class support for Git and Jujutsu (jj) version control.

## Git Commits

Create commits with the Commit component:

```tsx
import { Commit } from "smithers-orchestrator/components/Git";

<Commit
  message="feat: Add user authentication"
  all  // Stage all changes
  notes={{ smithers: true, prompt: "Add auth" }}
  onFinished={(result) => {
    console.log(`Committed: ${result.commitHash}`);
  }}
/>
```

## Auto-Generated Messages

Let Claude generate the commit message:

```tsx
<Commit autoGenerate all />
```

## Selective Commits

Commit specific files:

```tsx
<Commit
  message="fix: Update config"
  files={["config.json", "settings.ts"]}
/>
```

## Git Notes

Store metadata in git notes:

```tsx
<Commit
  message="feat: New feature"
  notes={{
    smithers: true,
    executionId: executionId,
    prompt: "Implement the new feature",
    model: "sonnet",
  }}
/>
```

Read notes:

```bash
git notes show HEAD
```

## Code Review

Review changes before committing:

```tsx
function ReviewAndCommit() {
  const [phase, setPhase] = useState("implement");

  return (
    <Ralph maxIterations={5}>
      {phase === "implement" && (
        <Claude
          allowedTools={["Edit", "Write"]}
          onFinished={() => setPhase("review")}
        >
          Implement the feature.
        </Claude>
      )}

      {phase === "review" && (
        <Review
          target={{ type: "diff", ref: "main" }}
          criteria={[
            "No security vulnerabilities",
            "Tests included",
          ]}
          onFinished={(review) => {
            if (review.approved) {
              setPhase("commit");
            } else {
              setPhase("implement");
            }
          }}
        />
      )}

      {phase === "commit" && (
        <Commit
          autoGenerate
          all
          onFinished={() => setPhase("done")}
        />
      )}
    </Ralph>
  );
}
```

## Snapshots (Jujutsu)

For jj users, create snapshots:

```tsx
// Before risky operations
await db.vcs.logSnapshot({
  snapshotId: await jjSnapshot(),
  description: "Before refactoring",
  timestamp: new Date(),
});

// Perform work...

// Rollback if needed
const snapshots = await db.vcs.getSnapshots(1);
await jjRestore(snapshots[0].snapshotId);
```

## Database Tracking

All VCS operations are logged to the database:

```tsx
// Log a commit
await db.vcs.logCommit({
  hash: "abc123",
  message: "feat: Add feature",
  author: "claude",
  timestamp: new Date(),
  filesChanged: 5,
  insertions: 100,
  deletions: 20,
  vcsType: "git",
});

// Query commits
const commits = await db.vcs.getCommits(10);
```

## Review Tracking

```tsx
// Log a review
await db.vcs.logReview({
  reviewId: "r1",
  target: "abc123",
  approved: false,
  summary: "Issues found",
  issues: [
    { severity: "high", file: "auth.ts", description: "..." }
  ],
});

// Get blocking reviews
const blocking = await db.vcs.getBlockingReviews();
```

## Complete Workflow

```tsx
function FeatureWorkflow() {
  const [phase, setPhase] = useState("implement");

  return (
    <SmithersProvider db={db} executionId={executionId} snapshotBeforeStart>
        <Ralph maxIterations={10}>
          {phase === "implement" && (
            <Phase name="Implementation">
              <Claude
                allowedTools={["Edit", "Write"]}
                onFinished={() => setPhase("test")}
              >
                Implement the feature.
              </Claude>
            </Phase>
          )}

          {phase === "test" && (
            <Phase name="Testing">
              <Claude
                allowedTools={["Bash"]}
                onFinished={(result) => {
                  if (result.output.includes("PASS")) {
                    setPhase("review");
                  } else {
                    setPhase("implement");
                  }
                }}
              >
                Run the tests.
              </Claude>
            </Phase>
          )}

          {phase === "review" && (
            <Phase name="Review">
              <Review
                target={{ type: "diff", ref: "main" }}
                criteria={["No security issues", "Tests pass"]}
                onFinished={(review) => {
                  if (review.approved) {
                    setPhase("commit");
                  } else {
                    setPhase("implement");
                  }
                }}
              />
            </Phase>
          )}

          {phase === "commit" && (
            <Phase name="Commit">
              <Commit
                autoGenerate
                all
                notes={{ smithers: true }}
                onFinished={() => setPhase("done")}
              />
            </Phase>
          )}
        </Ralph>
    </SmithersProvider>
  );
}
```

## Related

<CardGroup cols={2}>
  <Card title="Commit Component" icon="code-commit" href="/components/commit">
    Commit API reference
  </Card>
  <Card title="Review Component" icon="magnifying-glass" href="/components/review">
    Review API reference
  </Card>
  <Card title="VCS API" icon="code-branch" href="/api-reference/vcs">
    Database VCS operations
  </Card>
</CardGroup>
