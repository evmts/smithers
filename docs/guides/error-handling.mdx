---
title: Error Handling
description: Handle errors gracefully in Smithers workflows
---

# Error Handling

```tsx
<Claude
  onFinished={(result) => console.log("Success:", result.output)}
  onError={(error) => console.error("Failed:", error.message)}
>
  Perform the task.
</Claude>
```

## Retry with State

```tsx
import { useQueryValue } from "smithers-orchestrator/reactive-sqlite";

function RetryWorkflowBody() {
  const { db, reactiveDb } = useSmithers();
  const { data: attemptsVal } = useQueryValue<number>(
    reactiveDb, "SELECT CAST(value AS INTEGER) FROM state WHERE key = 'attempts'"
  );
  const attempts = attemptsVal ?? 0;
  const { data: lastError } = useQueryValue<string>(
    reactiveDb, "SELECT value FROM state WHERE key = 'lastError'"
  );

  return (
    <>
      <If condition={attempts < 3}>
        <Claude
          onFinished={() => db.state.set("lastError", null)}
          onError={(err) => {
            db.state.set("lastError", err.message);
            db.state.set("attempts", attempts + 1);
          }}
        >
          {lastError && <>Previous: {lastError}</>}
          Attempt {attempts + 1}/3.
        </Claude>
      </If>
      <If condition={attempts >= 3}>
        <Stop reason={`Failed after 3 attempts: ${lastError}`} />
      </If>
    </>
  );
}
```

## Stop Conditions

```tsx
<SmithersProvider
  db={db}
  executionId={executionId}
  stopConditions={[
    { type: "total_tokens", value: 50000 },
    { type: "report_severity", value: "critical" },
    { type: "custom", fn: (r) => r.output.includes("FATAL"), message: "Fatal error" },
  ]}
/>
```

## Graceful Degradation

```tsx
function ResilientWorkflowBody() {
  const { db, reactiveDb } = useSmithers();
  const { data: approach } = useQueryValue<string>(
    reactiveDb, "SELECT value FROM state WHERE key = 'approach'"
  );

  return (
    <>
      <If condition={approach === "full"}>
        <Claude model="opus" maxTurns={20}
          onFinished={() => db.state.set("approach", "done")}
          onError={() => db.state.set("approach", "simple")}
        >
          Comprehensive analysis.
        </Claude>
      </If>
      <If condition={approach === "simple"}>
        <Claude model="sonnet" maxTurns={5} allowedTools={["Read"]}
          onFinished={() => db.state.set("approach", "done")}
          onError={() => db.state.set("approach", "manual")}
        >
          Simplified analysis.
        </Claude>
      </If>
      <If condition={approach === "manual"}>
        <Human message="Automated analysis failed" onApprove={() => db.state.set("approach", "done")}>
          Please review manually.
        </Human>
      </If>
    </>
  );
}
```

## Timeout Handling

```tsx
<Claude
  timeout={60000}
  onError={(error) => {
    if (error.message.includes("timeout")) {
      setApproach("shorter");
    }
  }}
>
```

## Related

<CardGroup cols={2}>
  <Card title="SmithersProvider" icon="sitemap" href="/components/smithers-provider" />
  <Card title="VCS API" icon="code-branch" href="/api-reference/vcs" />
</CardGroup>
