---
title: MCP Integration Guide
description: Connect Claude agents to external tools and services using the Model Context Protocol
---

# MCP Integration Guide

The Model Context Protocol (MCP) enables Claude agents to access external tools and services beyond the built-in Agent SDK tools. This guide shows you how to integrate MCP servers into your Smithers agents.

## What is MCP?

MCP is an open protocol that standardizes how AI agents communicate with external systems. MCP servers expose tools (functions) that agents can call to:

- Access databases (PostgreSQL, SQLite, MongoDB)
- Query APIs (GitHub, Slack, Jira, etc.)
- Read/write files with specialized formats
- Perform web searches
- Execute custom business logic

Smithers integrates MCP servers at the component level, allowing you to scope tool access to specific agents.

## Quick Start

### 1. Install an MCP Server

MCP servers are typically distributed as npm packages:

```bash
# Install the filesystem MCP server
npm install @modelcontextprotocol/server-filesystem

# Or use npx (no installation required)
npx -y @modelcontextprotocol/server-filesystem
```

### 2. Configure in Your Agent

Use the `mcpServers` prop on Claude/ClaudeApi components:

```tsx
import { Claude, MCPPresets } from 'smithers'

function FileProcessorAgent() {
  return (
    <Claude
      mcpServers={{
        filesystem: MCPPresets.filesystem(['/path/to/project']),
      }}
    >
      Read the README.md file and summarize it.
    </Claude>
  )
}
```

### 3. Run Your Agent

The MCP server automatically starts when the agent executes and stops when it completes.

## Built-in Presets

Smithers provides presets for common MCP servers:

### Filesystem

Read and write files beyond Agent SDK's built-in tools:

```tsx
import { Claude, MCPPresets } from 'smithers'

<Claude
  mcpServers={{
    filesystem: MCPPresets.filesystem([
      '/home/user/projects',
      '/tmp',
    ]),
  }}
>
  Search for all TypeScript files and generate a summary.
</Claude>
```

**Allowed paths** restrict which directories the server can access.

### Git

Execute git operations on repositories:

```tsx
<Claude
  mcpServers={{
    git: MCPPresets.git('/path/to/repo'),
  }}
>
  Create a new branch called "feature/new-auth" and switch to it.
</Claude>
```

**Note**: The `git` preset requires a git repository at the specified path.

### GitHub

Access GitHub API for repository management:

```tsx
<Claude
  mcpServers={{
    github: MCPPresets.github({
      owner: 'anthropics',
      repo: 'claude-code',
    }),
  }}
>
  Fetch all open pull requests and summarize their status.
</Claude>
```

**Requires**: `GITHUB_PERSONAL_ACCESS_TOKEN` environment variable.

### SQLite

Query SQLite databases:

```tsx
<Claude
  mcpServers={{
    sqlite: MCPPresets.sqlite('/path/to/database.db'),
  }}
>
  Query the users table and count active users.
</Claude>
```

### Memory

Simple key-value storage across agent calls:

```tsx
<Claude
  mcpServers={{
    memory: MCPPresets.memory(),
  }}
>
  Store the key "last_processed" with value "2024-01-01".
</Claude>
```

**Use case**: Maintain state between agent invocations.

### Fetch

HTTP requests to external APIs:

```tsx
<Claude
  mcpServers={{
    fetch: MCPPresets.fetch(),
  }}
>
  Fetch the latest news from https://api.example.com/news and summarize the top 3 articles.
</Claude>
```

### Brave Search

Web search using Brave Search API:

```tsx
<Claude
  mcpServers={{
    brave: MCPPresets.braveSearch(process.env.BRAVE_API_KEY),
  }}
>
  Search for "Model Context Protocol tutorial" and summarize the top results.
</Claude>
```

**Requires**: Brave Search API key.

### Postgres

Query PostgreSQL databases:

```tsx
<Claude
  mcpServers={{
    postgres: MCPPresets.postgres(process.env.DATABASE_URL),
  }}
>
  Query the orders table and calculate total revenue for last month.
</Claude>
```

**Requires**: PostgreSQL connection string.

### Custom Stdio Server

Run any MCP server command:

```tsx
<Claude
  mcpServers={{
    custom: MCPPresets.custom(
      'my-server',
      'node',
      ['/path/to/my-mcp-server.js', '--port', '8080']
    ),
  }}
>
  Use the custom server to process data.
</Claude>
```

### HTTP Server

Connect to an MCP server over HTTP:

```tsx
<Claude
  mcpServers={{
    remote: MCPPresets.http('https://mcp.example.com'),
  }}
>
  Call the remote MCP server's tools.
</Claude>
```

## Multiple MCP Servers

Combine multiple servers for powerful workflows:

```tsx
<Claude
  mcpServers={{
    filesystem: MCPPresets.filesystem(['/path/to/project']),
    git: MCPPresets.git('/path/to/project'),
    github: MCPPresets.github({
      owner: 'myorg',
      repo: 'myrepo',
    }),
  }}
>
  1. Read the CHANGELOG.md file
  2. Create a new git branch "release/v1.2.0"
  3. Create a GitHub release draft with the changelog content
</Claude>
```

## Advanced Configuration

### Custom Transport Configuration

For full control, use the raw `MCPServerConfig` format:

```tsx
import type { MCPServerConfig } from 'smithers'

const customServer: MCPServerConfig = {
  name: 'my-custom-server',
  transport: {
    type: 'stdio',
    command: 'node',
    args: ['/path/to/server.js'],
    env: {
      MY_API_KEY: process.env.MY_API_KEY,
    },
  },
}

<Claude mcpServers={{ custom: customServer }}>
  Use the custom server.
</Claude>
```

### HTTP Transport

For remote MCP servers:

```tsx
const remoteServer: MCPServerConfig = {
  name: 'remote-api',
  transport: {
    type: 'http',
    url: 'https://mcp.example.com',
    headers: {
      Authorization: `Bearer ${process.env.API_TOKEN}`,
    },
  },
}

<Claude mcpServers={{ remote: remoteServer }}>
  Query the remote API.
</Claude>
```

## ClaudeProvider Integration

Share MCP servers across all agents using `ClaudeProvider`:

```tsx
import { ClaudeProvider, Claude, MCPPresets } from 'smithers'

function App() {
  return (
    <ClaudeProvider
      defaults={{
        mcpServers: {
          filesystem: MCPPresets.filesystem(['/path/to/project']),
          git: MCPPresets.git(),
          github: MCPPresets.github({
            owner: 'myorg',
            repo: 'myrepo',
          }),
        },
      }}
    >
      {/* All Claude components inherit these MCP servers */}
      <Claude>Task 1</Claude>
      <Claude>Task 2</Claude>

      {/* Override/extend with additional servers */}
      <Claude
        mcpServers={{
          sqlite: MCPPresets.sqlite('/data/app.db'),
        }}
      >
        Task 3 with extra database access
      </Claude>
    </ClaudeProvider>
  )
}
```

**Merging behavior:**

- Provider servers + component servers are merged
- Component servers override provider servers with same name
- Use this to set common servers at provider level and specialized servers at component level

## Tool Name Collisions

When MCP servers expose tools with the same name as Agent SDK built-in tools:

```tsx
<Claude
  tools={['Read', 'Write']}  // Built-in tools
  mcpServers={{
    filesystem: MCPPresets.filesystem(['/path']),  // May also have "Read"
  }}
>
  Read the file.
</Claude>
```

**Resolution:**

1. Built-in tools take precedence
2. MCP tools with colliding names are removed
3. A warning is logged to the console

**Best practice**: Avoid naming conflicts by using unique tool names in custom MCP servers.

## Scoped Tool Access

MCP servers are scoped to the component they're defined on:

```tsx
<>
  <Claude
    mcpServers={{
      filesystem: MCPPresets.filesystem(['/safe/path']),
    }}
  >
    This agent can access filesystem tools.
  </Claude>

  <Claude>
    This agent CANNOT access filesystem tools.
  </Claude>
</>
```

**Use case**: Limit tool access for security or isolation.

## Lifecycle Management

### Automatic Startup

MCP servers start automatically when the agent begins execution:

```tsx
<Claude mcpServers={{ git: MCPPresets.git() }}>
  {/* Git server starts here */}
  Create a new branch.
</Claude>
```

### Automatic Cleanup

Servers are disconnected when the agent completes:

```tsx
const result = await executePlan(
  <Claude mcpServers={{ git: MCPPresets.git() }}>
    List all branches.
  </Claude>
)
// Git server disconnected here
```

### Error Handling

If an MCP server fails to start, the agent continues without it:

```tsx
<Claude
  mcpServers={{
    broken: MCPPresets.custom('broken', 'nonexistent-command', []),
  }}
>
  {/* Server fails to start, but agent continues with built-in tools */}
  Perform task.
</Claude>
```

**Note**: Server startup errors are logged but don't crash the agent.

## Mock Mode

In mock mode, MCP servers are not started:

```tsx
const result = await executePlan(
  <Claude mcpServers={{ git: MCPPresets.git() }}>
    Create a branch.
  </Claude>,
  { mockMode: true }  // MCP servers skipped
)
```

**Use case**: Test agent logic without external dependencies.

## Security Considerations

### Filesystem Access

Always restrict filesystem paths to the minimum required:

```tsx
// ✓ Good: Specific project directory
<Claude
  mcpServers={{
    filesystem: MCPPresets.filesystem(['/path/to/project']),
  }}
>
  ...
</Claude>

// ✗ Bad: Root filesystem access
<Claude
  mcpServers={{
    filesystem: MCPPresets.filesystem(['/']),
  }}
>
  ...
</Claude>
```

### API Keys

Never hardcode API keys:

```tsx
// ✓ Good: Environment variables
<Claude
  mcpServers={{
    github: MCPPresets.github({ owner: 'myorg', repo: 'myrepo' }),
  }}
>
  ...
</Claude>
// GITHUB_PERSONAL_ACCESS_TOKEN read from env

// ✗ Bad: Hardcoded key
const config = {
  transport: {
    env: {
      API_KEY: 'sk-1234567890',  // NEVER DO THIS
    },
  },
}
```

### Principle of Least Privilege

Only provide MCP servers that agents actually need:

```tsx
// Agent only needs to read files
<Claude
  mcpServers={{
    filesystem: MCPPresets.filesystem(['/readonly/path']),
  }}
  allowedTools={['Read']}  // Disallow Write
>
  Analyze the codebase.
</Claude>
```

## Debugging MCP Connections

### Enable Debug Logging

Use the `debug` prop on `ClaudeProvider`:

```tsx
<ClaudeProvider debug={true}>
  <Claude mcpServers={{ git: MCPPresets.git() }}>
    ...
  </Claude>
</ClaudeProvider>
```

This logs:

- MCP server connection attempts
- Tool discovery results
- Tool execution requests/responses

### Check Server Status

Verify MCP servers are running manually:

```bash
# Test the filesystem server
npx -y @modelcontextprotocol/server-filesystem /path/to/project

# Test with stdio input
echo '{"jsonrpc":"2.0","id":1,"method":"initialize","params":{}}' | \
  npx -y @modelcontextprotocol/server-filesystem /path/to/project
```

### Common Issues

**Server not found:**

```
Error: spawn npx ENOENT
```

**Solution**: Ensure `npx` is installed (`npm install -g npx`).

**Permission denied:**

```
Error: EACCES: permission denied
```

**Solution**: Check filesystem permissions and allowed paths.

**Tool not available:**

```
Warning: MCP tool 'my_tool' collides with built-in tool, removing MCP tool
```

**Solution**: Rename the MCP tool or disable the built-in tool.

## Use Cases

### Database Query Agent

Query a PostgreSQL database and generate reports:

```tsx
<Claude
  mcpServers={{
    postgres: MCPPresets.postgres(process.env.DATABASE_URL),
  }}
>
  Query the sales table for last month's revenue by region.
  Generate a summary report in markdown format.
</Claude>
```

### GitHub PR Reviewer

Review pull requests using GitHub API:

```tsx
<Claude
  mcpServers={{
    github: MCPPresets.github({
      owner: 'myorg',
      repo: 'myrepo',
    }),
  }}
>
  Fetch PR #{prNumber}, review the code changes, and post a comment with:
  - Security concerns
  - Code quality issues
  - Test coverage gaps
</Claude>
```

### File Migration Agent

Migrate files between systems:

```tsx
<Claude
  mcpServers={{
    source: MCPPresets.filesystem(['/old/system']),
    dest: MCPPresets.filesystem(['/new/system']),
  }}
>
  Copy all .md files from /old/system to /new/system,
  converting to .mdx format and updating image paths.
</Claude>
```

### Web Research Agent

Search the web and synthesize information:

```tsx
<Claude
  mcpServers={{
    search: MCPPresets.braveSearch(process.env.BRAVE_API_KEY),
  }}
>
  Research "TypeScript performance optimization techniques".
  Synthesize the top 5 most recommended techniques with examples.
</Claude>
```

### Multi-Source Data Agent

Combine data from multiple sources:

```tsx
<Claude
  mcpServers={{
    postgres: MCPPresets.postgres(process.env.DB_URL),
    github: MCPPresets.github({ owner: 'myorg', repo: 'myrepo' }),
    fetch: MCPPresets.fetch(),
  }}
>
  1. Query the database for active customers
  2. Fetch their GitHub activity from the API
  3. Fetch weather data from the weather API
  4. Generate a personalized report for each customer
</Claude>
```

## Writing Custom MCP Servers

To create your own MCP server, follow the [MCP specification](https://modelcontextprotocol.io/docs/spec):

1. **Implement the protocol**: Handle `initialize`, `tools/list`, `tools/call` JSON-RPC methods
2. **Define tools**: Expose functions as MCP tools with JSON schemas
3. **Handle stdio or HTTP**: Use stdio or HTTP transport
4. **Test locally**: Run the server and test with JSON-RPC requests
5. **Integrate with Smithers**: Use `MCPPresets.custom()` or raw config

**Example server structure:**

```typescript
// my-mcp-server.ts
import { MCPServer } from '@modelcontextprotocol/sdk'

const server = new MCPServer({
  name: 'my-custom-server',
  version: '1.0.0',
})

server.tool({
  name: 'my_tool',
  description: 'Does something useful',
  schema: {
    type: 'object',
    properties: {
      input: { type: 'string' },
    },
    required: ['input'],
  },
  handler: async (params) => {
    // Your tool logic here
    return { result: `Processed: ${params.input}` }
  },
})

server.listen()
```

**Use in Smithers:**

```tsx
<Claude
  mcpServers={{
    custom: MCPPresets.custom(
      'my-custom-server',
      'node',
      ['/path/to/my-mcp-server.js']
    ),
  }}
>
  Call my_tool with input "test".
</Claude>
```

## Performance Considerations

### Server Startup Time

MCP servers take ~100-500ms to start:

- **stdio servers**: ~100-200ms (spawn process)
- **HTTP servers**: ~50-100ms (connect)

**Optimization**: Reuse `ClaudeProvider` defaults to share servers across agents.

### Tool Call Latency

Each tool call has overhead:

- **stdio**: ~10-50ms (IPC)
- **HTTP**: ~50-200ms (network)

**Optimization**: Batch operations when possible.

### Memory Usage

Each MCP server process uses ~10-50MB RAM:

- Consider memory limits when running many parallel agents
- Use HTTP transport for shared servers

## Related

<CardGroup cols={2}>
  <Card title="Claude Component" icon="robot" href="/components/claude">
    Configure MCP servers on Claude agents
  </Card>
  <Card title="ClaudeProvider" icon="layer-group" href="/components/claude-provider">
    Share MCP servers across agents
  </Card>
  <Card title="MCP Specification" icon="book" href="https://modelcontextprotocol.io">
    Learn about the Model Context Protocol
  </Card>
</CardGroup>
