import { createSignal } from 'solid-js'
import { Claude, Phase, Step, Persona } from '@evmts/smithers'

# Multi-Agent Development Team

export function Architect(props) {
  return (
    <Claude onFinished={props.onPlan}>
      <Persona role="software architect">
        You design clean, maintainable systems.
      </Persona>

      <Phase name="plan">
        <Step>Analyze the requirements</Step>
        <Step>Break down into subtasks</Step>
        <Step>Define interfaces between components</Step>
      </Phase>

      Task: {props.task}

      Return a JSON array of subtasks, each with: name, description, dependencies.
    </Claude>
  )
}

export function Developer(props) {
  return (
    <Claude onFinished={props.onComplete}>
      <Persona role="senior developer">
        You write clean, tested code.
      </Persona>

      <Phase name="implement">
        <Step>Read existing code for context</Step>
        <Step>Implement the feature</Step>
        <Step>Write unit tests</Step>
      </Phase>

      Subtask: {props.subtask.name}
      Description: {props.subtask.description}
    </Claude>
  )
}

export function Reviewer(props) {
  return (
    <Claude onFinished={props.onApprove}>
      <Persona role="tech lead">
        You ensure code quality and correctness.
      </Persona>

      <Phase name="review">
        <Step>Run the test suite</Step>
        <Step>Review code changes</Step>
        <Step>Check for edge cases</Step>
      </Phase>

      Review all changes and approve if tests pass and code is clean.
    </Claude>
  )
}

export function DevTeam(props) {
  const [stage, setStage] = createSignal('planning')
  const [plan, setPlan] = createSignal(null)
  const [completed, setCompleted] = createSignal([])

  return () => {
    const s = stage()
    const p = plan()
    const c = completed()

    if (s === 'planning') {
      return (
        <Architect
          task={props.task}
          onPlan={(res) => {
            setPlan(res)
            setStage('implementing')
          }}
        />
      )
    }

    if (s === 'implementing') {
      const remaining = p.subtasks.filter(
        (sub) => !c.includes(sub.name)
      )

      if (remaining.length === 0) {
        setStage('reviewing')
        return null
      }

      const next = remaining[0]
      return (
        <Developer
          subtask={next}
          onComplete={() => setCompleted([...c, next.name])}
        />
      )
    }

    return (
      <Reviewer
        onApprove={() => setStage('done')}
      />
    )
  }
}

<DevTeam task="Add user authentication with email/password login" />